import{a as Ve,b as it}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-BBHJW5WF.js";import{a as we,b as tt}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-MRIJX65S.js";import{e as xe,f as et}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-GKFJ7ZLN.js";import{a as W,b as _e}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-7W6GAFFK.js";import{a as ve,b as Fe}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-7RV7N453.js";import{d as le,g as Ze,i as $e,j as ae,l as ce,m as ue,n as pe,p as fe,q as de,r as me,s as ye,t as Je}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-YM5H3BT6.js";import{a as S,b as B}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-FWO3KNVK.js";import{d as be,e as Se,f as Te,p as Qe}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-WSWR4Q44.js";import{d as U,e as he,g as ge}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-ZWSDUWXW.js";import{p as se,q as Ye}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-CYBVJMMN.js";import{a as ie,c as Ge}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-FFSQZJFP.js";import{b as re,h as Xe}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-C3SKTX2K.js";import{C as oe,E as ne}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-U6WQ4G6W.js";import{a as z}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-7ZY2VSVL.js";import{A as C,b as $,i as J,k as Q,q as V,t as F,v as ee}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-5JZ2YWXB.js";import{a as j,j as te,k as g,l as k}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-KI5HOILD.js";import{b as D}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-IJGABWID.js";import{a as x,c as Z}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-SLUQJE2K.js";import{a as h,b as Y,d as M,f as a}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-4X7D5KOI.js";var ke=h(()=>{"use strict"});var Pe=Y(We=>{"use strict";var _=z();function rt(t,i){return t===i&&(t!==0||1/t===1/i)||t!==t&&i!==i}var ot=typeof Object.is=="function"?Object.is:rt,nt=_.useSyncExternalStore,st=_.useRef,lt=_.useEffect,at=_.useMemo,ct=_.useDebugValue;We.useSyncExternalStoreWithSelector=function(t,i,e,r,o){var n=st(null);if(n.current===null){var l={hasValue:!1,value:null};n.current=l}else l=n.current;n=at(function(){function p(m){if(!y){if(y=!0,d=m,m=r(m),o!==void 0&&l.hasValue){var s=l.value;if(o(s,m))return f=s}return f=m}if(s=f,ot(d,m))return s;var X=r(m);return o!==void 0&&o(s,X)?s:(d=m,f=X)}var y=!1,d,f,u=e===void 0?null:e;return[function(){return p(i())},u===null?void 0:function(){return p(u())}]},[i,e,r,o]);var c=nt(t,n[0],n[1]);return lt(function(){l.hasValue=!0,l.value=c},[c]),ct(c),c}});var Oe=Y((Rt,Le)=>{"use strict";Le.exports=Pe()});function K(t,i){if(Object.is(t,i))return!0;if(typeof t!="object"||t===null||typeof i!="object"||i===null)return!1;if(t instanceof Map&&i instanceof Map){if(t.size!==i.size)return!1;for(let[r,o]of t)if(!Object.is(o,i.get(r)))return!1;return!0}if(t instanceof Set&&i instanceof Set){if(t.size!==i.size)return!1;for(let r of t)if(!i.has(r))return!1;return!0}let e=Object.keys(t);if(e.length!==Object.keys(i).length)return!1;for(let r of e)if(!Object.prototype.hasOwnProperty.call(i,r)||!Object.is(t[r],i[r]))return!1;return!0}var Re=h(()=>{"use strict"});function ut(t){return typeof t=="function"}function pt(t,i){return typeof i<"u"}function ft(t){return typeof t=="number"||typeof t=="string"||typeof t=="boolean"||typeof t>"u"||t===null}function dt(t){return Array.isArray(t)||t instanceof Map||t instanceof Set||t instanceof WeakMap||t instanceof WeakSet||typeof t=="object"}function H(t){return t instanceof b}function mt(t){return["constructor","prototype",...Object.getOwnPropertyNames(t)]}var T,Ae,b,P=h(()=>{"use strict";T=M(z());_e();Ae=M(Oe());Re();ne();b=class t{constructor(){a(this,"__reactiveListeners",new Set);a(this,"__currentState",{});a(this,"__internalKeys",[]);a(this,"__detachedKeys",[]);this.__internalKeys=mt(this),W(this)}initStore(i={}){i.detachedKeys?.length&&(this.__detachedKeys=i.detachedKeys);let e={},r=Object.getOwnPropertyNames(this);for(let o of r){if(this.__internalKeys.includes(o))continue;let n=this[o],l=o;if(typeof n=="function"){e[l]=n;continue}if(H(n)){e[l]=n,this.isDetached(l)||n.subscribe(()=>this.syncChildrenStores(l,n));continue}(ft(n)||dt(n))&&(e[l]=n)}this.__currentState=e}isDetached(i){return this.__detachedKeys.includes(i)}getState(){return this.__currentState}setState(i){let e=ut(i)?i(this.__currentState):i;if(!Object.is(e,this.__currentState)){let r=this.__currentState,o=Object.entries(e);for(let[n,l]of o){let c=n;(!r[c]||!H(r[c]))&&H(l)&&(this.isDetached(c)||l.subscribe(()=>this.syncChildrenStores(c,l)))}Object.assign(this,e),this.__currentState=Object.assign({},this.__currentState,e);for(let n of this.__reactiveListeners)n(this.__currentState,r)}}syncChildrenStores(i,e){let r={[i]:e};this.setState(r)}subscribe(i,e,r=!1){let o=l=>(this.__reactiveListeners.add(l),()=>{this.__reactiveListeners.delete(l)});if(e&&pt(i,e)){let l=i,c=e,p=r?K:Object.is,y=l(this.getState());return o(d=>{let f=l(d);if(!p(y,f)){let u=y;y=f,c(f,u)}})}return o(i)}static createContext(){let i=(0,T.createContext)(void 0);function e({children:n,value:l}){if(!(typeof l=="object"&&l!==null&&l instanceof t))throw new Error("Only instances of `ReactiveStore` should be used inside `Provider`");return oe(i.Provider,{value:l,children:n})}function r(){let n=(0,T.useContext)(i);if(!n)throw new Error("`useStore` hook must be used inside `Provider`");return n}function o(n,l=!1){let c=r(),p=(0,T.useRef)(c.subscribe.bind(c)).current,y=(0,T.useRef)(c.getState.bind(c)).current;return(0,Ae.useSyncExternalStoreWithSelector)(p,y,y,n,l?K:Object.is)}return{Provider:e,useStore:o}}}});var O,L,N,Ee=h(()=>{"use strict";tt();_e();C();Z();O=class O{constructor(){a(this,"observer",null);a(this,"observedElements",new Map);a(this,"handleResize",J(i=>{for(let e of i){let r=this.observedElements.get(e.target);if(r){let{top:o,left:n,width:l,height:c}=e.contentRect;r({top:o,left:n,width:l,height:c})}}},20));W(this),!x()&&(this.observer=new we(this.handleResize))}observe(i,e){this.observedElements.set(i,e),this.observer?.observe(i)}unobserve(i){this.observedElements.delete(i),this.observer?.unobserve(i)}static getInstance(){return this._instance||(this._instance=new O),this._instance}};a(O,"_instance",null);L=O,N={observe(t,i){L.getInstance().observe(t,i)},unobserve(t){L.getInstance().unobserve(t)}}});var w,Ie=h(()=>{"use strict";P();Qe();Ee();w=class extends b{constructor(){super();a(this,"ref",null);a(this,"offset",{top:0,left:0,width:0,height:0});a(this,"rect",{top:0,left:0,width:0,height:0});this.initStore()}setElement(e){if(e===null||this.ref===e)return;let r=this.ref;r&&N.unobserve(r),this.setState({ref:e}),this.ref&&(this.setState({offset:this.calculateOffsets(),rect:Te(e)}),N.observe(this.ref,o=>{this.setState({offset:this.calculateOffsets(),rect:o})}))}calculateOffsets(){return this.ref?{width:this.ref.offsetWidth,height:this.ref.offsetHeight,top:be(this.ref),left:Se(this.ref)}:{width:0,height:0,top:0,left:0}}}});var A,R,E,Me=h(()=>{"use strict";Z();ge();A=class A{constructor(){a(this,"store",new Map);a(this,"primaryObserver",null);a(this,"secondaryObserver",null);a(this,"primaryObserverMargin",0);a(this,"secondaryObserverMargin",0);a(this,"rootObserver",null);a(this,"entriesLoop",(i,e,r)=>{for(let o of i){let n=this.store.get(o.target);if(n){let l=!1;(o.isIntersecting||o.intersectionRatio>0)&&e(n.state)&&(l=!0),o.intersectionRatio<=0&&r(n.state)&&(l=!0),l&&n.listener(n.state)}}});a(this,"handlePrimaryVisibility",i=>{this.entriesLoop(i,e=>e.isVisible?!1:(e.isVisible=!0,e.wasVisible=!0,!0),e=>e.isVisible?(e.isVisible=!1,!0):!1)});a(this,"handleSecondaryVisibility",i=>{this.entriesLoop(i,e=>e.aboutToShow?!1:(e.aboutToShow=!0,!0),e=>e.aboutToShow?(e.aboutToShow=!1,!0):!1)});x()||(this.primaryObserver=new IntersectionObserver(this.handlePrimaryVisibility,{root:this.rootObserver,rootMargin:U(this.primaryObserverMargin)}),this.secondaryObserverMargin=x()?0:window.innerHeight*.25,this.secondaryObserver=new IntersectionObserver(this.handleSecondaryVisibility,{root:this.rootObserver,rootMargin:U(this.secondaryObserverMargin)}))}observe(i,e=!1,r){let o={isVisible:e,wasVisible:e,aboutToShow:e};return this.store.set(i,{listener:r,state:o}),this.primaryObserver?.observe(i),this.secondaryObserver?.observe(i),o}unobserve(i){this.store.delete(i),this.primaryObserver?.unobserve(i),this.secondaryObserver?.unobserve(i)}static getInstance(){return this._instance||(this._instance=new A),this._instance}};a(A,"_instance",null);R=A,E={observe(t,i,e){return R.getInstance().observe(t,i,e)},observeMultiple(t,i,e){let r=()=>{e({isVisible:o.some(n=>n.isVisible),wasVisible:o.some(n=>n.wasVisible),aboutToShow:o.some(n=>n.aboutToShow)})},o=t.map(n=>E.observe(n,i,r))},unobserve(t){let i=R.getInstance(),e=Array.isArray(t)?t:[t];for(let r of e)i.unobserve(r)}}});var I,Ce=h(()=>{"use strict";D();$e();P();Xe();Ge();I=class extends b{constructor(e){super();a(this,"project");a(this,"linkData",null);this.initStore(),this.project=e.project,this.setState({linkData:this.getLinkData(e.widget.model)}),this.project.subscribe(r=>r.pages,()=>{this.setState({linkData:this.getLinkData(e.widget.model)})})}doesWidgetHasLink(e){return["button","picture","shape",ie("widget.lottieLinks")?"lottie":null].includes(e.type)}getLinkData(e){if(!e||!this.doesWidgetHasLink(e)||!e.clickLink)return null;if(e.clickLink?.toLowerCase()==="__rm_anchor")return{type:"Anchor",target:e.clickTarget,url:`${e.anchor_link_pos}px`,anchorPosition:e.anchor_link_pos,pageId:e.clickPage,closeTip:e.closeTip};if(e.clickLink?.toLowerCase().includes("mailto:"))return{type:"Email",target:e.clickTarget,url:e.clickLink.toLowerCase().replace("mailto:",""),closeTip:e.closeTip};if(e.clickLink?.toLowerCase().includes("tel:"))return{type:"Phone",target:e.clickTarget,url:e.clickLink.toLowerCase().replace("tel:",""),closeTip:e.closeTip};if(e.clickLink?.toLowerCase().includes("back to top"))return{type:"ScrollToTop",url:"",closeTip:e.closeTip};if(e.clickLink?.toLowerCase()==="__rm_goback")return{type:"GoBack",url:"",closeTip:e.closeTip};if(this.project.getPageNum(e.clickLink)){let r=this.project.getPageNum(e.clickLink);return{type:"Page",target:e.clickTarget,pageId:e.clickLink,url:r?`${r}`:"",closeTip:e.closeTip}}else if(re(e.clickLink))return{type:"URL",target:e.clickTarget,url:e.clickLink,closeTip:e.closeTip};return null}}});function v(t){switch(t){case"phone_portrait":return"viewport_phone_portrait";case"tablet_portrait":return"viewport_tablet_portrait";default:return"viewport_default"}}function gt(t,i){let e=v(i);if(e!=="viewport_default"){let r=t[e];if(r&&Object.keys(r).length>0)return t[e]}return t}function di(t,i){let e=gt(t,i);return e&&e.height?e.height:t.height}function mi({pageViewport:t,desktopWidth:i,phoneWidth:e}){return!t||t==="default"?i||g.dictionary.default.width:t==="phone_portrait"?e||g.dictionary.phone_portrait.width:g.dictionary[t].width}var De=h(()=>{"use strict";k()});var ze=h(()=>{"use strict"});function Li(t){if(typeof t=="number"&&t!==0){let i=Math.PI/180*t;return{angle:t,radians:i,cos:Math.cos(i),sin:Math.sin(i)}}return null}function bt({rotation:t,point:i,origin:e}){if(!t||V(t))return i;let{cos:r,sin:o}=t;if(e){let c={x:e.left+e.width/2,y:e.top+e.height/2},p=c.x+(i.x-c.x)*r-(i.y-c.y)*o,y=c.y+(i.x-c.x)*o+(i.y-c.y)*r;return{x:p,y}}let n=r*i.x+o*i.y,l=r*i.y-o*i.x;return{x:n,y:l}}function je(t){return typeof t=="string"?t:t===!0?"swing":null}function Oi(t){let i=t.loop||(t.steps.length?t.steps[0].loop:void 0);if(i){let e=je(i);if(e)return{startIndex:0,value:e}}else{let e=t.steps.findIndex((r,o)=>o!==0&&r.loop);if(e>-1){let r=t.steps[e],o=je(r?.loop);if(r&&o)return{startIndex:e,value:o}}}return null}function Ri(t){return t?.steps.length&&t.steps[0].startWhenInView||!1}function St(t){return!t||V(t)||V(t.steps)||!t.type||t.type==="none"}function Ue(t,i){let e=t.animation,r=e&&!Array.isArray(e)?[e]:e||[];if(!r?.length)return;let o=!!t.fixed_position,n=t.is_full_width,l=t.is_full_height,c=!o&&!n&&!l,p=[];for(let y of r){if(St(y))continue;let d=S(y);if(c||(d.UUID=wt(JSON.stringify(d))),d.trigger){let m=d.trigger;d.trigger=m&&!Array.isArray(m)?[m]:m||[],i&&d.trigger&&(d.trigger=d.trigger.filter(s=>i.includes(s)))}let f=[],u={dx:0,dy:0,from_opacity:100,opacity:100,from_rotate:0,rotate:0,from_scale:100,scale:100};for(let m=0;m<d.steps.length;m++){let s=S(d.steps[m]);(!s.use_bezier||s.use_bezier&&!s.curve)&&(s.curve={}),s.curve&&!s.curve.c1&&(s.curve.c1={x:u.dx??0,y:u.dy??0}),s.use_move?(u.dx=s.dx,u.dy=s.dy):(s.dx=u.dx,s.dy=u.dy),s.curve&&!s.curve.c2&&(s.curve.c2={x:s.dx??0,y:s.dy??0}),s.use_opacity?(u.from_opacity=s.from_opacity,u.opacity=s.opacity):(s.from_opacity=u.from_opacity,s.opacity=u.opacity),s.use_scale?(u.from_scale=s.from_scale,u.scale=s.scale):(s.from_scale=u.from_scale,s.scale=u.scale),s.use_rotate?(u.from_rotate=s.from_rotate,u.rotate=s.rotate):(s.from_rotate=u.from_rotate,s.rotate=u.rotate),n&&(s.dx=0,s.rotate=0,s.from_rotate=0),l&&(s.dy=0,s.rotate=0,s.from_rotate=0),d.type==="scroll"&&!o&&m===0&&(s.delay_px=0),m!==0&&(delete s.from_opacity,delete s.from_rotate,delete s.from_scale),f.push(s)}f.length&&p.push({...d,steps:f})}if(p.length)return Tt(p)}function q(t,i){let e={...t};if(i.rotation?.angle!==0){let{x:r,y:o}=bt({rotation:i.rotation,point:{x:t.x??0,y:t.y??0}});e.x=r,e.y=o}return i.flipX&&e.x!==0&&(e.x*=-1),i.flipY&&e.y!==0&&(e.y*=-1),e}function Ai(t,i){let e=[];for(let r of t.steps){let o={...r},{x:n,y:l}=q({x:o.dx??0,y:o.dy??0},i);o.dx=n,o.dy=l,typeof o.from_rotate=="number"&&o.from_rotate!==0&&(i.flipX&&(o.from_rotate*=-1),i.flipY&&(o.from_rotate*=-1)),typeof o.rotate=="number"&&o.rotate!==0&&(i.flipX&&(o.rotate*=-1),i.flipY&&(o.rotate*=-1)),o.curve={c1:q(r.curve.c1,i),c2:q(r.curve.c2,i)},e.push(o)}return{...t,steps:e}}function Tt(t){let i=["click","hover","scroll","load","moveOnly","nonMove"];function e(r){return r.steps?.every(o=>o.use_move&&!o.use_scale&&!o.use_rotate)?"moveOnly":r.steps?.every(o=>!o.use_move)?"nonMove":r.type}return t.sort((r,o)=>i.indexOf(e(r))-i.indexOf(e(o)))}function Ei(t){return t?.length?t.some(i=>i.type==="click"):!1}function Ii(t){return t?.length?t.some(i=>i.type==="hover"):!1}function Mi(t){return t?.length?t.some(i=>i.type==="scroll"):!1}function Ci(t){return t?.length?t.some(i=>i.steps?.some(e=>e.use_rotate||e.use_move||e.use_scale)):!1}function Di(t){return t?.length?t.some(i=>i.steps?.some(e=>e.use_opacity)):!1}function vt(t=[]){return!!t.find((e,r)=>e.use_rotate&&(r===0&&e.from_rotate!==0||e.rotate!==0))}function xt(t=[]){return!!t.find((e,r)=>e.use_scale&&(r===0&&e.from_scale!==100||e.scale!==100))}function zi(t=[]){let i=le()?se().animationType==="bezier":!0,e=typeof window<"u"?window.CSS.supports('(offset-path: path("M 0,0")) and (offset-rotate: 0deg) and (offset-distance: 1px)'):!0,r=_t();return!i||!e?!1:r?!vt(t)&&!xt(t):!0}function ji(t,i){let e={};return i==="from"?(t.use_move&&(e.x=0,e.y=0),t.use_rotate&&typeof t.from_rotate=="number"&&(e.rotate=t.from_rotate),t.use_scale&&typeof t.from_scale=="number"&&(e.scale=t.from_scale/100),t.use_opacity&&typeof t.from_opacity=="number"&&(e.opacity=t.from_opacity/100)):(t.use_move&&(typeof t.dy=="number"&&(e.y=t.dy),typeof t.dx=="number"&&(e.x=t.dx)),t.use_rotate&&typeof t.rotate=="number"&&(e.rotate=t.rotate),t.use_scale&&typeof t.scale=="number"&&(e.scale=t.scale/100),t.use_opacity&&typeof t.opacity=="number"&&(e.opacity=t.opacity/100)),typeof e.opacity!="number"&&(e.opacity=1),typeof e.rotate!="number"&&(e.rotate=0),typeof e.scale!="number"&&(e.scale=1),typeof e.x!="number"&&(e.x=0),typeof e.y!="number"&&(e.y=0),e}function Ui(t,i,e){let r={},o=ee(t,e?["scale","rotate"]:["x","y","scale","rotate"]);return Object.keys(o).length&&(r.transform=he(o,!0)),typeof t.opacity=="number"&&(r.opacity=t.opacity,r.opacity===0&&!i?r.visibility="hidden":r.visibility="visible"),r}function wt(t){let i=0;for(let e=0;e<t.length;e++){let r=t.charCodeAt(e);i=(i<<5)-i+r,i|=0}return String(Math.abs(i))}var _t,Be=h(()=>{"use strict";D();C();B();ge();Ze();Ye();_t=()=>{let t=typeof window<"u"?window.navigator.userAgent:"";if(/ Safari\//.test(t)&&!/ Chrom/.test(t)){let i=navigator.userAgent.match(/ Version\/(\d+)/)??[];return i[1]?Number(i[1])<=15:!1}else return!1}});function Vt(t,i,e){let r=i[g.globalPrefix+t]||[],o=r.find(n=>n.pid===e)||r.find(n=>n.pid==="default");return!o||o.value===void 0?i[t]:o.value}function G(t,i){let e=S(t);for(let r of g.globalKeys)if(e[`${g.globalPrefix}${r}`]){let o=Vt(r,e,i);typeof o<"u"&&(e[r]=o)}return e}var Ke=h(()=>{"use strict";k();B()});function gr(t,i=!1){return kt(t,i)}var qe,He,Ne,kt,Wt,hr,Pt=h(()=>{"use strict";qe=M(z());D();k();k();C();B();ke();P();Ie();Me();Ce();Fe();et();De();ze();Je();Be();Ke();it();He=99999,Ne=class t extends b{constructor(e){super();this.options=e;a(this,"_model");a(this,"currentViewport");a(this,"model");a(this,"element");a(this,"animationElement");a(this,"visibility");a(this,"link");a(this,"triggersStore");a(this,"animationsStore");a(this,"zIndexStore");a(this,"hasViewports",!1);a(this,"isWidgetTrigger");a(this,"rendered",!1);a(this,"unbindViewportListener");this.initStore({detachedKeys:["zIndexStore","triggersStore","animationsStore"]}),this._model=this.prepareWidgetData(e.widget,e.pageMeta?.state?.widgetsIds);let r=e.pageMeta?.state.currentViewport||e.project.projectViewport.value;this.setState({triggersStore:e.triggersStore,animationsStore:e.animationsStore,zIndexStore:e.zIndexStore,currentViewport:e.initialViewport||r,element:new w,animationElement:new w,model:this._model}),this.computeWidgetModel();let o=this.getInitialVisibility();this.setState({isWidgetTrigger:this.triggersStore.isWidgetTrigger(this.model._id),visibility:o,rendered:o.isVisible}),this.bindViewportListener(e.project.projectViewport,e.pageMeta),this.bindElementListener(),this.bindTriggersListener(),(!e.initialViewport||e.initialViewport===r)&&this.animationsStore.addWidget({widgetId:this.model._id,animations:this.model.animation||[],rotation:this.model.angle,flipX:!!this.model.flip_h,flipY:!!this.model.flip_v,rect:{width:this.model.is_full_width?this.model.full_width_initial_w||this.model.w:this.model.w,height:this.model.is_full_height?this.model.full_height_initial_h||this.model.h:this.model.h,top:this.model.is_full_height?this.model.full_height_initial_y||this.model.y:this.model.y,left:this.model.is_full_width?this.model.full_width_initial_x||this.model.x:this.model.x}}),this.setState({link:new I({widget:this,project:e.project})})}bindElementListener(){let e=()=>{let r=[this.element.ref,this.animationElement.ref].filter(Boolean);return r.length&&E.unobserve(r),E.observeMultiple(r,this.visibility.isVisible,o=>{(0,qe.startTransition)(()=>{let n={visibility:o};o.isVisible&&!this.rendered&&(n.rendered=!0),this.setState(n)})})};this.element.subscribe(r=>r.ref,r=>{r&&((this.model.is_full_height||this.model.is_full_width)&&(this.animationsStore.updateWidgetRect(this.model._id,this.element.rect),this.element.subscribe(o=>o.rect,o=>{this.animationsStore.updateWidgetRect(this.model._id,o)})),e(),this.triggersStore.bindTriggerElement(this.model._id,r))}),this.animationElement.subscribe(r=>r.ref,()=>{this.animationElement.ref&&e()})}bindTriggersListener(){this.triggersStore.subscribe(()=>{let e=this.triggersStore.isWidgetTrigger(this.model._id);e!==this.isWidgetTrigger&&this.setState({isWidgetTrigger:e})})}addTriggerCallback(e){return this.triggersStore.addTriggerCallback({...e,responderWidgetId:this.model._id})}bindViewportListener(e,r){r&&(this.setState({currentViewport:r.state.currentViewport}),this.unbindViewportListener=r.subscribe(o=>o.state.currentViewport,o=>this.setCurrentViewport(o)))}setCurrentViewport(e){this.setState({currentViewport:e}),this.computeWidgetModel()}computeWidgetModel(){let e=this.currentViewport;this.setState({model:this.getViewportData(e),hasViewports:this.calculateHasViewports()})}getViewportData(e){let r=v(e);return e==="default"||!this.hasViewport(e)?this._model:{...this._model,...this._model[r]}}setViewportWidgetState(e){let r=this.currentViewport,o=this._model;if(typeof e.z=="number"&&this.zIndexStore.setZIndex(this._model._id,e.z),r==="default")Object.assign(this._model,{...e});else{let n=v(r);Object.assign(this._model,{[n]:{...o[n]||{},...e}})}this.computeWidgetModel()}prepareWidgetData(e,r){let o=S(e);return te(o,(n,l)=>{if(!n)return;let c=t.getWidgetViewportData(o,l,o.pid);for(let p of g.globalKeys)typeof c?.[p]<"u"&&(n[p]=c[p]);"animation"in n&&(n.animation=Ue(n,r)),ae(n)&&Object.assign(n,Ve(n)),de(n)&&Object.assign(n,{fields:n.fields.filter(p=>p.tp!=="captcha")})}),o}isHiddenInViewport(e=this.currentViewport){let r=this.getViewportData(e);return!!(!r||r.hidden)}hasViewport(e){let r=v(e);return r==="viewport_default"?!0:r in this._model&&Object.keys(this._model[r]).length>0}calculateHasViewports(){return Object.values(j).some(e=>!this.isHiddenInViewport(e))}moveTo(e){this.setViewportWidgetState(e)}zIndexToTop(){this.setViewportWidgetState({z:this.model.z+He})}zIndexResetToNormal(){this.setViewportWidgetState({z:this.model.z-He})}setTopmostZIndex(){this.setViewportWidgetState({z:this.zIndexStore.getTopmostZIndex()+1})}getInitialVisibility(){let e={height:2e3,width:2e3,left:0,top:0};if(["background","rmheader"].includes(this.model.type))return{isVisible:!0,wasVisible:!0,aboutToShow:!0};let r=this.model.fixed_position?xe.getFixedPositionBox(this.model.fixed_position,{w:this.model.w,h:this.model.h,x:this.model.x,y:this.model.y},1,e):{left:this.model.x,top:this.model.y},o=ve.isPointInBox(r,e);return{isVisible:o,wasVisible:o,aboutToShow:o}}clone(e={}){return new t({...this.options,...e})}getLockedViewportClone(e){let r=this.clone({initialViewport:e});return r.unbindViewportListener&&r.unbindViewportListener(),r.setState({currentViewport:e}),r.computeWidgetModel(),r}static getWidgetViewportData(e,r,o){let n=S(e);if(me(n)||ye(n))return n;let l=v(r);if(l in n){let c=S(n),p={},y=Object.keys(n[l]);for(let f of y){if(pe(n)&&(f==="borders"||f==="weight"||f==="bg_color")||ue(n)&&f==="picture"||ce(n)&&n.version===3&&f==="blocks")continue;let u=!1;u||(p[f]=void 0),u||(p[f]=fe(n)&&!n[l][f]&&Q(g.viewport_fields.button,g.viewport_fields_common).includes(f)?n[f]:void 0)}let d=$(c,p,F(n[l],["_id","modelType"]));return d.is_global?G(d,o):d}else if(r==="default")return n.is_global?G(n,o):n;return null}static canUseWidgetForLayerType(e,r){if(!e)return!1;if(e.type==="background"&&r==="fixed"||e.type==="rmheader")return!0;let o=e?.fixed_position&&r==="regular",n=!e?.fixed_position&&r==="fixed";return!o&&!n}},{useStore:kt,Provider:Wt}=b.createContext(),hr=Wt});export{b as a,P as b,Li as c,bt as d,Oi as e,Ri as f,Ai as g,Ei as h,Ii as i,Mi as j,Ci as k,Di as l,zi as m,ji as n,Ui as o,Be as p,ke as q,w as r,Ie as s,v as t,di as u,mi as v,De as w,ze as x,G as y,Ke as z,Ne as A,hr as B,gr as C,Pt as D};

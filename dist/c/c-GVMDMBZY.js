import{a as u}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-CY2FEJLT.js";import{d as $,e as O}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-5EGHSVLS.js";import{a as h,b as I}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-XFMJR2GD.js";import{h as x,w as y}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-MVDJARLS.js";import{a as d,b as L}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-LUPS5IAT.js";import{c as m,d as v}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-WEREZOGV.js";import{b,c as _}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-DQFZXCVV.js";import{a as U}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-H3ZPPNIG.js";import{b as w}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-S4OSB3PN.js";import{d as f}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-4X7D5KOI.js";var r=f(U()),l=f(w());v();_();L();I();O();y();var C=u.extend({antialiasRotation:!0,render:function(){this.makeBox("widget-picture"),this.listenTo(this.page.mag,"change:viewport",this.onMagViewportBeforeChange),this.isLightboxEnabled()&&this.initLightbox(),this.hasHoverAnimation&&this.$el.addClass("has-onhover-animation"),this.rendered=!0,this.$lqipImg=null,this.useLqip=!h.isDownloadedSource&&this.mag?.viewOpts?.lqip&&!!this.blurHash&&(h.useLambdaUrl(this.picture)||h.useLambdaUrlOldProjects(this.picture));let i=this.getPictureUrl();if(/\.gif/.test(i)&&(this.isGIF=!0),this.$el.html(""),this.isVector(i)&&!b.IS_FILE_PROTOCOL)this.loadVector(i);else{let s=!!(this.border_size>0||this.border_radius>0||this.border_radius_max||this.border_radius_independent&&(this.border_radius_tl>0||this.border_radius_tr>0||this.border_radius_bl>0||this.border_radius_br>0)||this.is_full_width||this.is_full_height),t=this.opacity===void 0?1:this.opacity;if(this.insideHotspot&&this.isGIF){let e=this.scale;(0,r.default)("<div/>").appendTo(this.$el).css({position:"absolute","background-image":"url("+i+")","background-position":"50% 50%",width:Math.max(Math.round(this.originalW*e),this.w),height:Math.max(Math.round(this.originalH*e),this.h),top:-Math.round(this.cropY*e),left:-Math.round(this.cropX*e)}).attr("url",i)}else if(s){let e=x(this.border_color||"000000",typeof this.border_color_opacity>"u"?1:this.border_color_opacity/100),o=`rgba(${e.r}, ${e.g}, ${e.b}, ${e.a})`;(0,r.default)("<div/>").appendTo(this.$el).addClass("bgpic").css({"background-image":this.useLqip?"":`url(${i})`,"background-position":`${this.fhpos?this.fhpos:50}% ${this.fwpos?this.fwpos:50}%`,"box-shadow":this.border_size>0?`inset 0 0 0 ${this.border_size}px ${o}`:"none","border-radius":this.getBorderRadius(),opacity:this.useLqip?0:t}).attr("url",this.useLqip?"":i)}if(h.useLambdaUrl(this.picture)||h.useLambdaUrlOldProjects(this.picture)){let e=h.getSrcset(this.picture,{...this.getPictureOptions()});(0,r.default)("<img/>").attr("srcset",e).attr("alt",this.getAltText()).attr("src",i).addClass("viewable").toggleClass("saveable",!!(s||this.insideHotspot&&this.isGIF)).css("opacity",0).load(l.default.bind(function(){let o=this.$el.find(".viewable"),a=o&&o.get(0)&&o.get(0).currentSrc||i,n=this.$el.find(".bgpic");n&&n.css({opacity:t,"background-image":`url(${a})`}).attr("url",a),o&&o.css("opacity",t),this.$lqipImg&&this.$lqipImg.css("opacity",0),l.default.delay(l.default.bind(function(){this.$el.css({overflow:"","border-radius":""}),this.$lqipImg&&this.$lqipImg.remove(),this.$lqipImg=null,this.widgetIsLoaded()},this),200)},this)).on("error",l.default.bind(function(){this.$lqipImg&&this.$lqipImg.remove(),this.$lqipImg=null,this.widgetIsLoaded()},this)).appendTo(this.$el),this.useLqip&&(this.$el.css("overflow","hidden"),(this.border_radius||this.border_radius_max||this.border_radius_independent)&&this.$el.css("border-radius",this.getBorderRadius()),this.$lqipImg=(0,r.default)("<div/>").addClass("lqip").css({"background-image":`url("${this.blurHash?h.decodeBlurHash(this.blurHash,this.w,this.h):h.getLqipUrl(this.picture,{cropX:this.cropX,cropY:this.cropY,cropW:this.cropW,cropH:this.cropH,originalW:this.originalW,originalH:this.originalH})}")`,"background-position":"50% 50%",opacity:t}).appendTo(this.$el))}else(0,r.default)("<img/>").appendTo(this.$el).toggleClass("saveable",!!(s||this.insideHotspot&&this.isGIF)).css("opacity",typeof this.opacity>"u"?1:this.opacity).addClass("viewable").load(l.default.bind(function(){this.$el.find("img").attr("url",i),this.widgetIsLoaded()},this)).on("error",this.widgetIsLoaded).attr("srcset",this.getSrcset()).attr("alt",this.getAltText()).attr("src",i)}return this.checkLink(),this},getBorderRadius:function(){return this.border_radius_independent?`${this.border_radius_tl||0}px ${this.border_radius_tr||0}px ${this.border_radius_br||0}px ${this.border_radius_bl||0}px`:`${this.border_radius_max?"9999":this.border_radius||0}px`},isLightboxEnabled:function(){let i=!!this.getAnimations().find(t=>t.type==="click"&&t.steps&&t.steps.length),s=!!this.clickLink;return this.lightbox?this.lightbox.enabled&&!i&&!s:this.preview_enabled&&!i&&!s},isValid:function(){return!!(this.picture&&(this.picture.type||this.picture.unscaledUrl||this.picture.finalUrl||this.picture.editedVectorUrl||this.picture.url))},isVector:function(i,s){let t=i||this.picture&&this.picture.url;return(s||this.picture&&this.picture.type)==="svg"?!0:t&&l.default.last(t.split(".")).indexOf("svg")===0},start:function(){return u.prototype.start.call(this),Modernizr.safari&&this.isGIF&&this.$el.flashClass("fix-safari-gif",100),this},getPictureOptions:function(){let i=this.getAnimations().reduce((s,t)=>Math.max(s,$.maxScaleAnimation(t)),0);return{width:this.w,height:this.h,cropX:this.cropX,cropY:this.cropY,cropW:this.cropW,cropH:this.cropH,originalW:this.originalW,originalH:this.originalH,scale:d.isScaleLayout(this.mag.viewOpts)?this.page.scale:1,animationScale:i&&i/100,isStretched:this.is_full_width||this.is_full_height}},getPictureUrl:function(){if(!this.picture)return"";if(h.useLambdaUrl(this.picture)||h.useLambdaUrlOldProjects(this.picture))return h.getLambdaUrl(this.picture,this.getPictureOptions());if(this.picture.finalUrl&&l.default.last(this.picture.finalUrl.split(".")).indexOf("svg")===0)return this.picture.finalUrl;let i;return d.isOnForRatio(this.page.pageViewport,this.page.scale,this.mag.viewOpts)?i=this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl||this.picture.final2xUrl||this.picture.finalUrl:Modernizr.retina?i=(window.devicePixelRatio>=3?this.picture.final3xUrl||this.picture.unscaledOptimizedUrl||this.picture.final2xUrl:this.picture.final2xUrl)||this.picture.unscaledOptimizedUrl||this.picture.finalUrl:i=this.picture.finalUrl,(this.is_full_width||this.is_full_height)&&(i=this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl||this.picture.final2xUrl||this.picture.finalUrl),i||this.picture.effectUrl||this.picture.editedVectorUrl||this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl||this.picture.url},getAltText:function(){return this.picture&&this.alt?l.default.escape(this.alt):void 0},getSrcset:function(i=!0){if(!this.picture)return[];if(!this.originalW)return[];if(this.isGIF)return[];if(d.isOn(this.page.pageViewport,this.mag.getViewportWidth(this.page.pageViewport),this.mag.viewOpts))return[];if(this.getAnimations().length)return[];if(RM.screenshot)return[];if(this.picture.finalUrl&&l.default.last(this.picture.finalUrl.split(".")).indexOf("svg")===0)return[];let s=Math.floor(this.w),t=[{url:this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl,size:this.originalW},{url:this.picture.final2xUrl&&(this.picture.unscaledOptimizedUrl||this.picture.final3xUrl),size:s*3},{url:this.picture.final2xUrl,size:s*2},{url:this.picture.finalUrl,size:s}];if(t=t.filter(function(o){return!!o.url&&this.originalW>=o.size}.bind(this)).map(function(o){return`${o.url} ${o.size}w`}),!i)return t;let e=[`${this.picture.finalUrl||this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl} 1x`];return this.picture.final2xUrl&&e.push(`${this.picture.final2xUrl} 2x`),this.picture.final2xUrl&&(this.picture.unscaledOptimizedUrl||this.picture.final3xUrl)&&e.push(`${this.picture.final2xUrl&&(this.picture.unscaledOptimizedUrl||this.picture.final3xUrl)} 3x`),e.concat(t)},loadVector:function(i){this.$el.addClass("svg"),this.svgAjax=r.default.get(i+"?c",l.default.bind(function(s){let t=(0,r.default)(m.cleanupSVG((0,r.default)(s).find("svg").get(0).cloneNode(!0)));t.get(0).removeAttribute("width"),t.get(0).removeAttribute("height"),this.$svg=t;let e=t.get(0).cloneNode(!0);this.$svg.find("title").remove();let a=new Image;(0,r.default)(a).on("load error",l.default.bind(function(){(0,r.default)(a).appendTo(window.document.body).css({width:"100%",height:"100%"});let n=(0,r.default)(e);n.get(0).setAttribute("viewBox","0 0 "+(0,r.default)(a).width()+" "+(0,r.default)(a).height()),n.appendTo(window.document.body);let c=n.get(0).getBBox();this.$svg.get(0).setAttribute("viewBox",c.x+" "+c.y+" "+c.width+" "+c.height),this.$svg.get(0).setAttribute("preserveAspectRatio","xMidYMid meet"),this.$svg.get(0).setAttribute("role","img");let p=this.getAltText();p&&this.$svg.get(0).setAttribute("aria-label",p),(0,r.default)(a).remove(),n.remove();let g=(0,r.default)('<div class="svg-scale-wrapper"></div>');this.$svg.appendTo(g),g.appendTo(this.$el),this.widgetIsLoaded()},this)),a.src=i},this)).fail(this.widgetIsLoaded)},initLightbox:async function(){this.lightbox&&(this.$el.on("click",()=>{this.page.showLightboxSlide(this)}),this.$el.addClass("preview-enabled"))},checkLightboxVisibility:function(i){if(i&&(this?.page?.lightboxModel?.get("isVisible")||!1)){let t=this?.page?.lightboxModel?.get("onClose");t&&typeof t=="function"&&t()}},onMagViewportBeforeChange:function(i){let s=i?.viewport;this.checkLightboxVisibility(s)}}),H=C;export{H as a};

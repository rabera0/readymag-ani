import{a as $,b as re}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-7W6GAFFK.js";import{a as z,b as ie}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-6L6VUWAD.js";import{a as M,d as oe}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-3TNMIIPH.js";import{c as D,o as te}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-URFCP7B2.js";import{a as K,b as R,c as W,e as L,g as h,h as ee}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-UMLFVHKK.js";import{a as E,c as Q}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-FFSQZJFP.js";import{d as w,h as X}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-C3SKTX2K.js";import{C as I,E as U}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-U6WQ4G6W.js";import{a as J}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-7ZY2VSVL.js";import{A as Z,d as C,r as S,w as F}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-5JZ2YWXB.js";import{b as _,c as q}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-DQFZXCVV.js";import{a as T,d as G,f as c}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-4X7D5KOI.js";function ne(e,t){let o=e.split(".");for(let r of t){let i=r[0];if(i==="set"||i==="delete"){let n=r[1],s=i==="set"?r[2]:void 0;if(S(n,o))return{result:s};let l=Y(n,o);if(l.length)return{result:se(l,s)};let u=Y(o,n);if(u.length)return{result:ue(u,s)}}}}function Y(e,t){let o=[];if(t.length>e.length)return[];for(let r=0;r<e.length;r++){let i=e[r],n=t[r];if(typeof n>"u")o.push(i);else if(i!==n)break}return o}function se(e,t){return F({},e,t)}function ue(e,t){return C(t,e)}function le(e){return typeof R(e)=="number"}var g,y,A=T(()=>{"use strict";g=G(J());re();Z();ee();U();y=class e{constructor(){return $(K(this))}useSnapshot(){return h(this)}subscribe(t,o){return W(this,r=>{if(typeof t=="string"){let i=t,n=o;if(typeof n=="function"){let s=ne(i,r);typeof s<"u"&&n(s.result)}}else{let i=t;typeof i=="function"&&i(this)}})}detach(t){return L(t)}static createContext(){let t=(0,g.createContext)(void 0);function o({children:n,value:s}){if(!(typeof s=="object"&&s!==null&&s instanceof e))throw new Error("Only instances of `ProxyClass` should be used inside `Provider`");return I(t.Provider,{value:s,children:n})}function r(){let n=(0,g.useContext)(t);if(!n)throw new Error("`useProxy` hook must be used inside `Provider`");return n}function i(n){let s=r(),d=h(s);if(typeof n=="function"){let l=n(d);return le(l)?h(l):l}return d}return{Provider:o,useSnapshot:i,useProxy:r}}}});var j,H=T(()=>{"use strict";A();j=class extends y{constructor(o){super();c(this,"player");c(this,"isStarted");c(this,"isReady",!1);c(this,"widget");c(this,"pageScale");c(this,"isPointerIn");c(this,"clickCount",0);c(this,"renderSimpleVersion",!1);c(this,"controlsCursorStyle");this.widget=o}}});var O,Ce,de=T(()=>{"use strict";X();oe();ie();q();te();Q();H();O={setVideoPosition:function(e){if(!e.aspect_poster||!e.$media||!e.$media.length)return;let t=e.$container.css("width"),o=e.$container.css("height");if(/px/.test(t+o))t=parseInt(t),o=parseInt(o);else{if(!e.mag)return;let a=e.mag.getContainerSizeCached();t=a.width,o=a.height}let r=e.aspect_poster,i=e.aspect_real||r,n=e.controls_remove?5:0,s=t+n*2,d=o+n*2,l=s,u=d;if(r){let a,m;s/d>i?(a=s,m=a/i):(m=d,a=m*i),r<i?(l=a,u=l/r):(u=m,l=u*r)}if(e.provider.toLowerCase()=="vimeo"&&e.controls_remove){var p=(u-d)/2,v=(l-s)/2,b=50,f=46,x=b-p,V=f-v;if(x>0||V>0){let a=(u+x*2)/u,m=(l+V*2)/l,k=Math.max(a,m);l*=k,u*=k}}if(e.provider.toLowerCase()=="youtube"&&e.controls_remove){var p=(u-d)/2,b=103,P=b-p;P>0&&(u+=P*2,l=u*r)}let B=-n-(l-s)/2,N=-n-(u-d)/2;e.$media.css({left:B,top:N,width:l,height:u})},getHighResVideoThumbnail:function(e){if(!e.provider||!e.thumbnail_url)return Promise.resolve(e.thumbnail_url||"");function t(o,r){return o.replace(/(\/)(\w*default)(\.\w+$)/i,"$1"+r+"$3")}switch(e.provider.toLowerCase()){case"vimeo":return Promise.resolve(e.thumbnail_url);case"youtube":return Promise.resolve(typeof e.video_url=="string"&&e.video_url.includes("shorts")?e.thumbnail_url:t(e.thumbnail_url,"maxresdefault"));default:return Promise.resolve(e.thumbnail_url)}},getEmbedData:async function(e,t,o,r){fetch(/oembed/i.test(e)?e:this.getEmbedUrl(e)).then(i=>i.json()).then(i=>{i.url=i.url&&w(i.url),i.thumbnail_url=i.thumbnail_url&&w(i.thumbnail_url),typeof t=="function"&&t(i)}).catch(i=>{o(i)}).finally(()=>{typeof r=="function"&&r()})},getEmbedUrl:function(e){if(this.isVimeo(e))return"https://vimeo.com/api/oembed.json?url="+encodeURIComponent(e)+"&width=1280";{let t=O.getYoutubeIdFromUrl(e);if(t)return"https://www.youtube.com/oembed?format=json&url="+encodeURIComponent("https://www.youtube.com/watch?v="+t)}return""},getYoutubeIdFromUrl:function(e){let t=/^.*(youtu.be\/|v\/|u\/\w\/|shorts\/|watch\?v=)([^#\&\?]*).*/,o=e.match(t);if(o&&o[2].length===11)return o[2];let r=/.*(youtu.*\&v=)([^#\&\?]*).*/;return o=e.match(r),o&&o[2].length===11?o[2]:null},getVimeoIdFromUrl:function(e){let t=e.match(/(video\/)(\w+)(_\d+x\d+|_\d+)(\.\w+$)/i);return t&&t[2]?t[2]:null},getVideoProvider:function(e){return this.isVimeo(e)?"Vimeo":this.isYoutube(e)?"YouTube":""},isVimeo:function(e){return/vimeo\.com\/.+/.test(e)},isYoutube:function(e){return e&&!!this.getYoutubeIdFromUrl(e)},brokenVimeoThumbnailRegexp:/\/\d+_[\dx]+(\.\w+)?$/,validateVideoFile:async function(e){let t={isValid:!0};if(!this.allowedVideoFormats.includes(e.type))return t.isValid=!1,t.errorType="FileFormatError",t.errorMessage="Please upload .mp4 or .mov files",t;if(E("widget.videoDetectCodecs")){let r=await this.probeVideoFile(e);if(r)t.metadata={size:e.size,duration:Math.floor(r.duration/r.timescale),width:r.videoTracks?.[0]?.video?.width,height:r.videoTracks?.[0]?.video?.height};else return t.isValid=!1,t.errorType="CodecDetectionError",t.errorMessage="Error detecting video codec",t;if(!this.isCodecAllowed(r.videoTracks?.[0]?.codec))return t.isValid=!1,t.errorType="InvalidCodecError",t.errorMessage="Please upload a video with H.264 codec",t}let{video_upload_limit:o}=z.getPermissions();return e.size>_.VIDEO_WIDGET_UPLOAD_SIZE_LIMIT?(t.isValid=!1,t.errorType="TooLargeError",t.errorMessage=`Please upload files smaller than ${M(_.VIDEO_WIDGET_UPLOAD_SIZE_LIMIT)}`,t):(e.size>o&&(t.isValid=!1,t.errorType="SubscriptionLimitError",t.errorMessage=D),t)},async probeVideoFile(e){return new Promise(async(t,o)=>{let{default:r}=await import("https://st-p.rmcdn.net/a09f30ec/dist/c/c-SWMJDM6K.js"),i=r.createFile(),n=new FileReader,s;i.onReady=function(u){s=u},i.onerror=o;let d=0,l=50*1024;do try{let u=await new Promise((p,v)=>{n.onload=b=>{let f=b.target.result;f.fileStart=d,d+=f.byteLength,p(f)},n.onerror=v,n.readAsArrayBuffer(e.slice(d,d+l))});if(u.byteLength)i.appendBuffer(u);else break}catch(u){console.log("error probing video file: ",u),o(u);break}while(!s);t(s)})},allowedVideoFormats:["video/mp4","video/quicktime"],allowedVideoCodecs:[/^avc1.42/i,/^avc1.4D/i,/^avc1.64/i],isCodecAllowed:function(e){return this.allowedVideoCodecs.some(t=>t.test(e))}},Ce=O});export{y as a,A as b,j as c,H as d,Ce as e,de as f};

import{a as E,b as ee}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-FQSEBC7W.js";import{a as D,d as K}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-CYBVJMMN.js";import{b as p,c as J}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-DQFZXCVV.js";import{a as I}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-4X7D5KOI.js";var z,H,S,w,P,te,_,v,re,ae,le,oe,F,j,ne,ie,se,ce,G,Y=I(()=>{"use strict";z=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],H=e=>{let t=0;for(let a=0;a<e.length;a++){let r=e[a],o=z.indexOf(r);t=t*83+o}return t},S=(e,t)=>{var a="";for(let r=1;r<=t;r++){let o=Math.floor(e)/Math.pow(83,t-r)%83;a+=z[Math.floor(o)]}return a},w=e=>{let t=e/255;return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},P=e=>{let t=Math.max(0,Math.min(1,e));return t<=.0031308?Math.trunc(t*12.92*255+.5):Math.trunc((1.055*Math.pow(t,.4166666666666667)-.055)*255+.5)},te=e=>e<0?-1:1,_=(e,t)=>te(e)*Math.pow(Math.abs(e),t),v=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},re=e=>{if(!e||e.length<6)throw new v("The blurhash string must be at least 6 characters");let t=H(e[0]),a=Math.floor(t/9)+1,r=t%9+1;if(e.length!==4+2*r*a)throw new v(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*r*a}`)},ae=e=>{let t=e>>16,a=e>>8&255,r=e&255;return[w(t),w(a),w(r)]},le=(e,t)=>{let a=Math.floor(e/361),r=Math.floor(e/19)%19,o=e%19;return[_((a-9)/9,2)*t,_((r-9)/9,2)*t,_((o-9)/9,2)*t]},oe=(e,t,a,r)=>{re(e),r=r|1;let o=H(e[0]),i=Math.floor(o/9)+1,s=o%9+1,d=(H(e[1])+1)/166,c=new Array(s*i);for(let l=0;l<c.length;l++)if(l===0){let n=H(e.substring(2,6));c[l]=ae(n)}else{let n=H(e.substring(4+l*2,6+l*2));c[l]=le(n,d*r)}let h=t*4,u=new Uint8ClampedArray(h*a);for(let l=0;l<a;l++)for(let n=0;n<t;n++){let m=0,x=0,y=0;for(let b=0;b<i;b++)for(let g=0;g<s;g++){let f=Math.cos(Math.PI*n*g/t)*Math.cos(Math.PI*l*b/a),M=c[g+b*s];m+=M[0]*f,x+=M[1]*f,y+=M[2]*f}let L=P(m),$=P(x),B=P(y);u[4*n+0+l*h]=L,u[4*n+1+l*h]=$,u[4*n+2+l*h]=B,u[4*n+3+l*h]=255}return u},F=oe,j=4,ne=(e,t,a,r)=>{let o=0,i=0,s=0,d=t*j;for(let h=0;h<t;h++){let u=j*h;for(let l=0;l<a;l++){let n=u+l*d,m=r(h,l);o+=m*w(e[n]),i+=m*w(e[n+1]),s+=m*w(e[n+2])}}let c=1/(t*a);return[o*c,i*c,s*c]},ie=e=>{let t=P(e[0]),a=P(e[1]),r=P(e[2]);return(t<<16)+(a<<8)+r},se=(e,t)=>{let a=Math.floor(Math.max(0,Math.min(18,Math.floor(_(e[0]/t,.5)*9+9.5)))),r=Math.floor(Math.max(0,Math.min(18,Math.floor(_(e[1]/t,.5)*9+9.5)))),o=Math.floor(Math.max(0,Math.min(18,Math.floor(_(e[2]/t,.5)*9+9.5))));return a*19*19+r*19+o},ce=(e,t,a,r,o)=>{if(r<1||r>9||o<1||o>9)throw new v("BlurHash must have between 1 and 9 components");if(t*a*4!==e.length)throw new v("Width and height must match the pixels array");let i=[];for(let l=0;l<o;l++)for(let n=0;n<r;n++){let m=n==0&&l==0?1:2,x=ne(e,t,a,(y,L)=>m*Math.cos(Math.PI*n*y/t)*Math.cos(Math.PI*l*L/a));i.push(x)}let s=i[0],d=i.slice(1),c="",h=r-1+(o-1)*9;c+=S(h,1);let u;if(d.length>0){let l=Math.max(...d.map(m=>Math.max(...m))),n=Math.floor(Math.max(0,Math.min(82,Math.floor(l*166-.5))));u=(n+1)/166,c+=S(n,1)}else u=1,c+=S(0,1);return c+=S(ie(s),4),d.forEach(l=>{c+=S(se(l,u),2)}),c},G=ce});function Q(e,t,a){let r=e*4+1,o=6+t*(5+r),i=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,e>>8,e&255,0,0,t>>8,t&255,8,6,0,0,0,0,0,0,0,o>>>24,o>>16&255,o>>8&255,o&255,73,68,65,84,120,1],s=[0,498536548,997073096,651767980,1994146192,1802195444,1303535960,1342533948,-306674912,-267414716,-690576408,-882789492,-1687895376,-2032938284,-1609899400,-1111625188],d=1,c=0;for(let h=0,u=0,l=r-1;h<t;h++,l+=r-1)for(i.push(h+1<t?0:1,r&255,r>>8,~r&255,r>>8^255,0),c=(c+d)%65521;u<l;u++){let n=a[u]&255;i.push(n),d=(d+n)%65521,c=(c+d)%65521}i.push(c>>8,c&255,d>>8,d&255,0,0,0,0,0,0,0,0,73,69,78,68,174,66,96,130);for(let[h,u]of[[12,29],[37,41+o]]){let l=-1;for(let n=h;n<u;n++)l^=i[n],l=l>>>4^s[l&15],l=l>>>4^s[l&15];l=~l,i[u++]=l>>>24,i[u++]=l>>16&255,i[u++]=l>>8&255,i[u++]=l&255}return"data:image/png;base64,"+btoa(String.fromCharCode(...i))}var V=I(()=>{"use strict"});function fe(e,t={}){let{dprSet:a=[2,3],...r}=t,o=[];if((a||[]).forEach(s=>{r.dpr=s;let d=A(e,r);d!==o[o.length-1]?.url&&o.push({dpr:s,url:d})}),t.asArray)return o;let i=o.map(s=>`${s.url} ${s.dpr}x`);return i.length>1?i.join(", "):void 0}function N(e){return Math.floor(Math.log10(e)*10)}var ue,q,O,T,X,de,k,he,Z,A,me,pe,ge,W,be,He,Me=I(()=>{"use strict";K();J();ee();Y();V();ue=!!(typeof window<"u"&&window.viewerConfig&&window.viewerConfig.homepageRewrite),q=!!(typeof window<"u"&&window.viewerConfig&&window.viewerConfig.isDownloadedSource)&&!ue,O=e=>p.allowedLambdaExt.includes(e),T=e=>!!(!q&&e&&e.lambdaUrl&&O(e.type)),X=(e,t)=>{switch(t){case"video":case"slideshow":return!!(!q&&e&&e.url&&O(e.type));case"background":return!!(!q&&e&&(e.url||e.finalUrl)&&O(e.type));default:return!!(!q&&e&&(e.unscaledUrl||e.unscaledOptimizedUrl)&&O(e.type))}},de=e=>!!(e&&e.lqipUrl||T(e)),k=(e={})=>{let{width:t,height:a,cropX:r,cropY:o,cropW:i,cropH:s,originalW:d=9999,originalH:c=9999,quality:h,ext:u,scale:l,animationScale:n,isStretched:m,dpr:x,lossless:y,nearLossless:L,fit:$="none",useLargerPictureSizeForBetterQuality:B=!1}=e,b=typeof window<"u"&&window.devicePixelRatio||p.minDpr,g=x||(b<p.minDpr?p.minDpr:b),f=[],M=Math.max(l||1,1),R=n||1;if(!m&&t){let U=B&&a?Math.max(t,a):t,C=Math.min(Math.round(U*g*M*R),d);C<d&&f.push(`w=${C}`)}if(!m&&!t&&a){let U=Math.min(Math.round(a*g*M*R),c);U<c&&f.push(`h=${U}`)}if(h&&f.push(`q=${h}`),u&&f.push(`e=${u}`),y&&f.push("ll=true"),L&&f.push("nll=true"),$==="auto"&&t&&a){let U=Math.min(Math.round(a*g*M*R),c);U<c&&f.push(`h=${U}`)}return r!==void 0&&o!==void 0&&i&&s&&(i!==d||s!==c)&&(f.push(`cX=${r}`),f.push(`cY=${o}`),f.push(`cW=${i}`),f.push(`cH=${s}`)),f.length?`?${f.join("&")}`:""},he=(e,t)=>{if(!e)return"";try{let a=new URL(t.useOriginalUrlForOldWidget?e.url||e.unscaledUrl||e.unscaledOptimizedUrl||e.finalUrl||"":e.unscaledUrl||e.url||e.unscaledOptimizedUrl||e.finalUrl||"");return`${p.readymag_lambda_host}${a.pathname}`}catch{return""}},Z=(e,t)=>e?`${e.lambdaUrl||he(e,t)}`:"",A=(e,t={},a={})=>{if(!e)return"";let r={...t};return!a.useOriginalUrlForOldWidget&&X(e)&&!T(e)&&(r.cropX=void 0,r.cropY=void 0,r.cropW=t.originalW,r.cropH=t.originalH),E.isSupported("webp")&&(r.ext="webp",e.type==="png"&&(r.nearLossless=!0)),`${Z(e,a)}${k(r)}`};me=(e,t={})=>{if(!e)return"";if(e.lqipUrl)return e.lqipUrl;let a={dpr:1,width:p.lqipWidth,quality:p.lqipQuality,...t};return A(e,a)},pe=(e,t={})=>{if(!e)return"";let a={width:p.THUMB_SIZE,height:p.THUMB_SIZE,quality:p.THUMB_QUALITY,fit:"auto",...t};return A(e,a)},ge=async e=>{let t=new Image;t.crossOrigin="Anonymous",t.src=e,await t.decode();let a=N(t.width),r=Math.floor(t.height*(a/t.width)),o=D.createElement("canvas");o.width=a,o.height=r;let i=o.getContext("2d");i?.drawImage(t,0,0,a,r);let s=i?.getImageData(0,0,a,r);return s?G(s.data,s.width,s.height,4,4):""},W=new Map,be=(e,t,a)=>{let r=N(t),o=Math.floor(a*(r/t)),i=F(e,r,o);if(W.has(e))return W.get(e);let s=Q(r,o,i);return W.set(e,s),s};He={isDownloadedSource:q,allowedLambdaExt:O,useLambdaUrl:T,useLambdaUrlOldProjects:X,useLqipUrl:de,getLambdaUrl:A,getOriginalLambdaUrl:Z,getLambdaParams:k,getSrcset:fe,getLqipUrl:me,getThumbnailUrl:pe,encodeBlurHash:ge,decodeBlurHash:be}});export{He as a,Me as b};

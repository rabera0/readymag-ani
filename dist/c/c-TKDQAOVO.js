import{a as W,b as I,e as T,f as x,g as V,i as v,j as U}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-YUQDIUKM.js";import{a as L,b as $}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-XFMJR2GD.js";import{g as _,h as P,k as H}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-JYGKCXLD.js";import{a as A,p as j}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-FCVJDNOX.js";import{e as C,o as E,q as f,w as M}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-MVDJARLS.js";import{a as g,b as F}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-LUPS5IAT.js";import{c as D,p as K}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-WSWR4Q44.js";import{c as b,d as B}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-CYBVJMMN.js";import{a as w,b as R}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-VPHMCDHS.js";import{b as h,c as N}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-DQFZXCVV.js";import{b as y}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-IJGABWID.js";import{a as l,f as a}from"https://st-p.rmcdn.net/a09f30ec/dist/c/c-4X7D5KOI.js";var it,Y=l(()=>{"use strict";R();it=async(s,t,e)=>w.get(`/api/viewer/project/${s}/widgets`,{pageId:t},{priority:"high",signal:e})});var u,O=l(()=>{"use strict";W();N();V();u=class{constructor(t){a(this,"numId");a(this,"libraryAdded",!1);a(this,"stripeAccount","");this.numId=t}async disconnect(t){return await T(t,"stripe")}async loadProducts(t,e){return(await x(t,!!e)).data||[]}mapProductsToSelectOptions(t,e){let i=t.filter(r=>r.active&&(r.articles?.length||r.prices?.length)||e&&e===r.id).map(r=>({value:r.id,caption:r.name}));return i.unshift({value:"default",caption:"None"}),i}isProductActive(t){return t.active&&(this.productHasActiveOptions(t)||this.productHasActivePrice(t))}productHasActiveOptions(t){return Array.isArray(t.articles)&&!!t.articles?.some(e=>e.active)}productHasActivePrice(t){return Array.isArray(t.prices)&&!!t.prices?.some(e=>e.active)}isProductAvailable(t,e){if(t.prices?.length)return this.productHasActivePrice(t);if(t.articles?.length)if(e){let i=t.articles?.find(r=>r.id===e);return i?this.isSkuAvailable(i):!1}else return!!t.articles?.some(i=>this.isSkuAvailable(i));return!1}isSkuAvailable(t){return t.active?t.inventory.type==="infinite"||!!(t.inventory.type==="finite"&&t.inventory.quantity)||t.inventory.type==="bucket"&&(t.inventory.value==="in_stock"||t.inventory.value==="limited"):!1}getProductForAddToCart(t,e){if(!t)return null;let i=this.getActivePrice(t);if(i){let o={...t,articles:null,prices:null};return{...i,productObject:o}}let r=e?this.getSkuBySelectsValues(t,e):null;if(r){let o={...t,articles:null,prices:null};return{...r,productObject:o}}return null}getActivePrice(t){if(Array.isArray(t.prices)&&t.prices.length){let e;return t.default_price&&(e=t.prices.find(i=>i.active&&i.billing_scheme==="per_unit"&&i.id===t.default_price)),e||(e=t.prices.find(i=>i.active&&i.billing_scheme==="per_unit")),e}return null}getSkuBySelectsValues(t,e){return!t||!Array.isArray(t.articles)||t.articles.length===0?null:t.articles.length===1?t.articles[0]:t.articles.find(i=>JSON.stringify(i.attributes)===JSON.stringify(e))}initFrontendLibrary(t){if(!this.libraryAdded&&t?.stripe?.stripe_data.stripe_user_id){let e=document.createElement("script");e.setAttribute("async","async"),e.setAttribute("src","https://js.stripe.com/v3/"),document?.body?.appendChild(e),this.libraryAdded=!0,this.stripeAccount=t.stripe.stripe_data.stripe_user_id}}getFormattedProductToAddToCart(t,e){if(e&&Object.keys(e).length)return null;let i={...t},r=this.getActivePrice(i);return!r||!r.unit_amount?null:{id:r.id,name:i.name,image:i.images?.[0],price:Number((r.unit_amount/100).toFixed(2)),currency:r.currency,type:r.type}}createCheckoutSession(t,e){let i=[],r=!1;Object.keys(t).forEach(n=>{i.push({price:t[n].id,quantity:t[n].cartQuantity}),t[n].type==="recurring"&&(r=!0)});let o=window?.location.href.split("?")[0],c=r?"subscription":"payment",d={line_items:i,success_url:`${o}?checkout_status=success&mode=${c}&session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${o}?checkout_status=cancel`,payment_method_types:["card"],mode:c,...e||{}};return r&&(d.shipping_options||d.shipping_address_collection)&&(delete d.shipping_options,delete d.shipping_address_collection),I(this.numId,d)}goToCheckout({items:t,options:e}){let i=h.stripe_live?h.STRIPE_LIVE_PUBLIC_KEY:h.STRIPE_TEST_PUBLIC_KEY,r=Stripe(i||"",{stripeAccount:this.stripeAccount});this.createCheckoutSession(t,e).then(({data:o})=>{r.redirectToCheckout({sessionId:o.id})}).catch(o=>{console.error("Error:",o)})}}});var z,G,S,Q=l(()=>{"use strict";B();O();U();H();W();j();y();z=["stripe","ecwid"],G={out_of_stock:"Out of stock"},S=class{constructor({numId:t,ecommerceData:e,cartWidgetData:i,isDownloadedSource:r,isPublished:o,isScreenshoter:c,onDataChange:d}){a(this,"isDownloadedSource");a(this,"isPublished");a(this,"isScreenshoter");a(this,"userLocale","en");a(this,"numId",0);a(this,"ecommerceData");a(this,"cartWidgetData");a(this,"provider");a(this,"products",[]);a(this,"productsState","initial");a(this,"isCartWidgetExist",!1);a(this,"adapter");a(this,"onDataChange");this.numId=t,this.isDownloadedSource=r,this.isPublished=o,this.isScreenshoter=c,this.ecommerceData=e,i&&(this.cartWidgetData=i,this.isCartWidgetExist=!0),d&&typeof d=="function"&&(this.onDataChange=d);let n=window.navigator.language;if(n&&(this.userLocale=n.substring(0,2)),this.ecommerceData){let p=this.getConnectedProvider();if(p){this.provider=p,this.connectEcommerceAdapter(),this.loadProducts();let m=localStorage.getItem(P(this.numId));m&&m!==this.provider&&localStorage.removeItem(_(this.numId)),localStorage.setItem(P(this.numId),this.provider)}}}setOnDataChangeCallback(t){this.onDataChange||(this.onDataChange=t)}triggerDataChanges(t){this.onDataChange&&this.onDataChange(t)}setCartWidgetExistState(t){this.isCartWidgetExist=t}getConnectedProvider(){if(this.provider)return this.provider;if(!this.ecommerceData)return null;let t=this.getProviderFrom(this.ecommerceData);return this.provider=t,t}getProviderFrom(t){return z.find(i=>t[i]&&t[i].status==="connected")}canBeConnectedTo(t){let e=this.getConnectedProvider();return!(e&&t!==e)}async updateEcommerceDataFromServer(){let t=await A(this.numId);if(t?.ecommerce_data)return this.updateEcommerceData(t.ecommerce_data),t.ecommerce_data}async updateEcommerceData(t){this.ecommerceData=t;let e=this.getProviderFrom(t);this.provider!==e&&(this.provider=e,this.connectEcommerceAdapter(),this.triggerDataChanges({provider:e}),await this.loadProducts())}getTextValue(t){let e=this.ecommerceData?.texts?.[t];return e?b.sanitize(e):G[t]}setTextValue(t,e){this.ecommerceData?.texts&&(this.ecommerceData.texts[t]=e)}async disconnect(){if(!this.provider||!this.adapter)throw new Error("Ecommerce provider is not defined");let t=await this.adapter.disconnect(this.numId),e={...this.ecommerceData};return t&&this.ecommerceData&&(e={...e,[this.provider]:t},this.updateEcommerceData(e)),e}connectEcommerceAdapter(){switch(this.provider){case"stripe":this.adapter=new u(this.numId);break;case"ecwid":this.adapter=new v(this.numId);break;default:this.adapter=void 0}}async loadProducts(){if(!this.provider||!this.adapter){this.products=[],this.triggerDataChanges({products:[]});return}if(this.isDownloadedSource&&this.provider&&this.ecommerceData){let e=this.ecommerceData?.[this.provider];if(e?.products){this.products=e.products,this.productsState="loaded";return}}this.productsState="loading";let t=[];try{t=await this.adapter.loadProducts(this.numId,this.isPublished,this.isScreenshoter),this.productsState="loaded"}catch(e){console.error("Load ecommerce products",e),this.productsState="error"}this.products=t,this.triggerDataChanges({products:t})}getProductById(t){return this.products?.find(e=>e.id===t)}getProductSelectOptions(t){return this.adapter?this.adapter.mapProductsToSelectOptions(this.products,t):[]}isProductActive(t){let e=this.getProductById(t);if(e)return this.adapter?this.adapter.isProductActive(e):!1}getInvalidAddToCartWidgets(t){let e=t.filter(r=>r.type==="addtocart"&&!r.hidden);if(!e.length)return[];let i=this.products?this.products.map(r=>r.id):[];return e.filter(r=>!r.selected_product_id||!i.includes(r.selected_product_id))}productHasActiveOptions(t){return this.adapter?this.adapter.productHasActiveOptions(t):!1}isProductAvailable(t,e){return!!this.adapter?.isProductAvailable(t,e)}getProductForAddToCart(t,e){return this.adapter?this.adapter.getProductForAddToCart(t,e):null}initFrontendLibrary(){this.adapter&&this.adapter.initFrontendLibrary(this.ecommerceData)}getFormattedProductToAddToCart(t,e){return this.adapter?this.adapter.getFormattedProductToAddToCart(t,e):null}goToCheckout(t,e,i,r){if(this.adapter)if(this.adapter instanceof v)this.adapter.goToCheckout({items:t,callbacks:{onOpen:e,onPlaced:async()=>{await this.loadProducts(),typeof i=="function"&&i()},onClose:r}});else if(this.adapter instanceof u){let o={allow_promotion_codes:!1};this.cartWidgetData&&(o.allow_promotion_codes=!!this.cartWidgetData["stripe-allow_promotion_codes"],this.cartWidgetData["stripe-allowed_countries"]?.length&&(o.shipping_address_collection={allowed_countries:this.cartWidgetData["stripe-allowed_countries"].map(c=>c.value)}),this.cartWidgetData["stripe-shipping_rates"]?.length&&(o.shipping_options=this.cartWidgetData["stripe-shipping_rates"].map(c=>({shipping_rate:c})))),this.adapter.goToCheckout({items:t,options:o})}else this.adapter.goToCheckout({items:t,callbacks:{onOpen:e,onPlaced:i}})}}});function X({widget:s,width:t,height:e}){let i=L.getLambdaUrl(s.picture,{width:t,height:e,cropH:s.cropH,cropW:s.cropW,cropX:s.cropX,cropY:s.cropY}),r=s.element.querySelector("img");return{previewImgSrc:r&&(r.currentSrc||r.src)||i,imgSrc:i}}function It(s){let t=[];for(let r of s)if(Z(r))if(r.lightbox)t.push({...r,element:r.$el.get(0)});else{let o=tt(r.preview_enabled,r.preview_overlay_color);t.push({...r,...o,element:r.$el.get(0)})}if(!t.length)return[];let e=[],i=D(t);for(let r of i){let o=r.h/r.w,c=window.innerHeight,d=window.innerWidth,n=c/o,p=n*o;n>d&&(n=d,p=n*o);let{imgSrc:m,previewImgSrc:k}=X({widget:r,width:n,height:p});e.push({_id:r._id,color:r.lightbox?.color||"",gallery:r.lightbox?.gallery||!1,height:p,width:n,imgSrc:m,previewImgSrc:k})}return e}function Tt(s){let t=g.isOn(s.viewport,s.viewportWidth,s.viewerOptions)&&g.isCSSZoom()?g.getRatio(s.viewportWidth):1,{top:e,left:i,height:r,width:o}=s.widgetElement.getBoundingClientRect(),c={top:e,left:i,height:r,width:o};if(Modernizr.safari){let n=window.scrollY;c.top=c.top+(n-n/t)}return{top:Number(c.top+c.height*.5)*t,left:Number(c.left+c.width*.5)*t,height:c.height*t,width:c.width*t}}function tt(s,t){if(typeof s<"u"||typeof t<"u"){let e=t?C(f(t))||"":"000000",i=e&&t&&f(t).a||.6;return{preview_enabled:void 0,preview_overlay_color:void 0,lightbox:{enabled:s,color:E(e,i*100)}}}}var Z,et=l(()=>{"use strict";y();F();$();M();K();Z=s=>s.type==="picture"});export{S as a,Q as b,it as c,Y as d,It as e,Tt as f,tt as g,et as h};
